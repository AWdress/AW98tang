# 配置文件说明

## 📝 快速开始

1. 复制 `config.json.example` 并重命名为 `config.json`
2. 修改以下**必填项**：
   - `username`: 你的论坛用户名
   - `password`: 你的论坛密码
   - `security_question_id`: 安全问题编号（见下方对照表）
   - `security_answer`: 安全问题的答案

## 🔐 账号配置（必填）

### 基础信息
```json
"base_url": "https://sehuatang.org/",
"username": "你的用户名",
"password": "你的密码"
```

### 安全提问配置

**重要：** 登录时需要回答安全问题，请在论坛个人设置中查看你选择的问题编号。

#### 安全问题对照表

| ID | 问题 |
|----|------|
| 0 | 不设置安全提问 |
| 1 | 母亲的名字 |
| 2 | 爷爷的名字 |
| 3 | 父亲出生的城市 |
| 4 | 您其中一位老师的名字 |
| 5 | 您个人计算机的型号 |
| 6 | 您喜欢的餐馆名称 |
| 7 | 驾驶执照最后四位数字 |

**示例配置：**
```json
"security_question_id": "3",
"security_answer": "北京"
```

## ⚙️ 功能开关

### 回复功能
```json
"enable_auto_reply": true,        // 启用自动回复
"enable_smart_reply": true,       // 启用智能回复（推荐）
"enable_ai_reply": false,         // 启用AI回复（需配置API）
"max_replies_per_day": 3,         // 每天回复数量
"reply_interval": [60, 120]       // 回复间隔（秒）[最小, 最大]
```

**说明：**
- `reply_interval`: 格式 `[最小值, 最大值]`
  - `[60, 120]` = 1-2分钟随机间隔（测试用）
  - `[3600, 7200]` = 1-2小时随机间隔（推荐）
  - `[7200, 14400]` = 2-4小时随机间隔（保守）

### 签到功能
```json
"enable_daily_checkin": true      // 启用每日签到
```

**重要：** 论坛要求先回复帖子才能签到！

### 测试模式
```json
"enable_test_mode": false,        // 全局测试（所有功能都不提交）
"enable_test_checkin": false,     // 测试签到（找到按钮但不点击）
"enable_test_reply": false        // 测试回复（输入内容但不发送）
```

**用途：** 首次使用时建议开启测试模式，验证功能正常后再关闭。

## ⏰ 定时任务

### 基础配置
```json
"enable_scheduler": true,         // 启用定时任务
"schedule_time": "03:00"          // 单一时间（兼容旧版）
```

### 多时间点调度（推荐）
```json
"schedule_times": [
  "03:00",    // 凌晨3点（夜间低峰期）
  "09:00",    // 上午9点（第一次备份）
  "15:00",    // 下午3点（第二次备份）
  "21:00"     // 晚上9点（最后备份）
]
```

### Cron表达式（高级）
```json
"schedule_cron": "0 3,9,15,21 * * *"
```

**Cron表达式示例：**
| 表达式 | 说明 |
|--------|------|
| `0 3 * * *` | 每天凌晨3点 |
| `0 3,9,15,21 * * *` | 每天3、9、15、21点 |
| `0 */6 * * *` | 每6小时 |
| `0 9 * * 1-5` | 工作日9点 |
| `0 10 * * 0,6` | 周末10点 |

**优先级：** `schedule_cron` > `schedule_times` > `schedule_time`

**重要特性：**
- ✅ 自动重试：失败后自动重试3次，间隔5分钟
- ✅ 智能跳过：签到成功后自动跳过后续运行

## 📍 目标论坛

```json
"target_forums": [
  "fid=141"                       // 论坛ID列表
],
"forum_names": {
  "fid=141": "网友原创区",        // 友好名称（Web界面显示）
  "fid=2": "亚洲无码原创区"
}
```

**如何获取论坛ID：**
从论坛URL中获取，例如：
```
https://sehuatang.org/forum.php?mod=forumdisplay&fid=141
                                                    ↑↑↑
                                                  这就是ID
```

## 🚫 过滤规则

### 跳过关键词
```json
"skip_keywords": [
  "公告", "通知", "规则", "版规",
  "置顶", "精华", "申诉", "发布器"
]
```

**作用：** 标题包含这些关键词的帖子会被跳过。

### 跳过前缀
```json
"skip_prefixes": [
  "【公告】", "【通知】",
  "公告:", "通知:"
]
```

**作用：** 标题以这些前缀开头的帖子会被跳过。

### 跳过管理员
```json
"admin_usernames": [
  "admin", "管理员", "版主"
]
```

**作用：** 这些用户发布的帖子会被跳过。

## 📝 回复模板

### 通用模板（备用）
```json
"reply_templates": [
  "谢谢楼主分享！",
  "感谢分享，收藏了！",
  "好资源，支持一下！"
]
```

**使用场景：** 仅在 `enable_smart_reply` 和 `enable_ai_reply` 都关闭时使用。

### 智能回复模板
```json
"smart_reply_templates": {
  "general": ["内容很不错！", "楼主辛苦了！"],
  "resource": ["资源很棒，感谢分享！"],
  "photo": ["照片拍得真不错！"],
  "video": ["视频质量不错！"]
}
```

**使用场景：** `enable_smart_reply: true` 时，根据帖子类型自动选择。

## 🤖 AI智能回复（可选）

```json
"enable_ai_reply": false,
"ai_api_type": "openai",
"ai_api_url": "https://api.openai.com/v1/chat/completions",
"ai_api_key": "你的API密钥",
"ai_model": "gpt-3.5-turbo",
"ai_temperature": 0.8,
"ai_max_tokens": 200,
"ai_timeout": 10,
"ai_system_prompt": "你是一个论坛用户..."
```

### 支持的API类型

#### OpenAI及兼容接口
```json
"ai_api_type": "openai",
"ai_api_url": "https://api.openai.com/v1/chat/completions",
"ai_model": "gpt-3.5-turbo"
```

#### 国产AI（兼容OpenAI格式）

**智谱AI (GLM)：**
```json
"ai_api_url": "https://open.bigmodel.cn/api/paas/v4/chat/completions",
"ai_model": "glm-4"
```

**DeepSeek：**
```json
"ai_api_url": "https://api.deepseek.com/v1/chat/completions",
"ai_model": "deepseek-chat"
```

**月之暗面 (Kimi)：**
```json
"ai_api_url": "https://api.moonshot.cn/v1/chat/completions",
"ai_model": "moonshot-v1-8k"
```

### AI参数说明

| 参数 | 说明 | 推荐值 |
|------|------|--------|
| `ai_temperature` | 生成随机性（0-1） | 0.8 |
| `ai_max_tokens` | 最大生成长度 | 200 |
| `ai_timeout` | 超时时间（秒） | 10 |

## 🌐 代理配置（可选）

```json
"proxy": {
  "enabled": false,                     // 是否启用代理
  "http_proxy": "http://127.0.0.1:7890",
  "https_proxy": "http://127.0.0.1:7890",
  "no_proxy": "localhost,127.0.0.1",
  "use_for_git": true,                  // Git更新使用代理
  "use_for_selenium": false             // Selenium使用代理
}
```

**使用场景：**
- 访问 GitHub 需要代理：`use_for_git: true`
- 访问目标网站需要代理：`use_for_selenium: true`

**代理格式：**
```
http://IP:端口
socks5://IP:端口
```

## 🔧 其他配置

```json
"enable_random_delay": false,         // 随机延迟
"log_level": "INFO"                   // 日志级别
```

**日志级别：**
- `DEBUG`: 最详细（开发调试用）
- `INFO`: 一般信息（推荐）
- `WARNING`: 警告信息
- `ERROR`: 仅错误

## 📊 推荐配置方案

### 保守型（安全）
```json
{
  "max_replies_per_day": 3,
  "reply_interval": [3600, 7200],
  "enable_scheduler": true,
  "schedule_times": ["03:00"]
}
```

**特点：** 每天凌晨3点运行，回复3个帖子，间隔1-2小时。

### 标准型（推荐）
```json
{
  "max_replies_per_day": 5,
  "reply_interval": [1800, 3600],
  "enable_scheduler": true,
  "schedule_times": ["03:00", "15:00"]
}
```

**特点：** 每天2次运行，每次5个帖子，间隔30分钟-1小时。

### 积极型（高频）
```json
{
  "max_replies_per_day": 10,
  "reply_interval": [600, 1800],
  "enable_scheduler": true,
  "schedule_cron": "0 */6 * * *"
}
```

**特点：** 每6小时运行一次，每次10个帖子，间隔10-30分钟。

## ⚠️ 安全建议

1. **回复间隔：** 不要少于30分钟
2. **每日回复：** 不要超过15个
3. **测试优先：** 首次使用先启用测试模式
4. **定期检查：** 查看日志文件确认运行正常
5. **密码安全：** 不要在公共场合暴露配置文件

## 🆘 常见问题

### 登录失败
- 检查用户名、密码是否正确
- 检查安全问题ID和答案是否匹配
- 查看 `debug/login_failed.png` 截图

### 签到失败
- 确认已成功回复至少1个帖子
- 检查日志中的验证码识别结果

### 没有回复
- 检查 `target_forums` 配置
- 检查 `skip_keywords` 是否过滤太多
- 查看日志确认具体原因

## 📚 相关文档

- [README.md](../README.md) - 项目说明
- [AUTO_RETRY_GUIDE.md](AUTO_RETRY_GUIDE.md) - 重试机制说明
- [README_SCHEDULER.md](README_SCHEDULER.md) - 定时任务说明
- [TROUBLESHOOTING.md](TROUBLESHOOTING.md) - 故障排查

---

**提示：** 修改配置后需要重启服务才能生效！
